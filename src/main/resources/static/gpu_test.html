<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test - GPU WORKER</title>
    <meta charset="UTF-8">
</head>
<body>
<h2>GPU ì›Œì»¤ WebSocket í…ŒìŠ¤íŠ¸ (/ws-gpu)</h2>
<div>
    <label for="workerId">Worker ID:</label>
    <input type="text" id="workerId" value="gpu-worker-001"> <button onclick="connect()">ì—°ê²° (ëŒ€ê¸° í’€ ì§„ì…)</button>
    <button onclick="disconnect()">ì—°ê²° ì¢…ë£Œ</button>
</div>
<div>
    <button onclick="sendTestData()">AI ì‘ë‹µ(GPU->ê³ ê°) ì „ì†¡</button>
</div>
<div>
    <h3>ë¡œê·¸:</h3>
    <pre id="log"></pre>
</div>

<script>
    let socket = null;

    function log(message) {
        const logEl = document.getElementById('log');
        logEl.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
    }

    function connect() {
        const workerId = document.getElementById('workerId').value;
        if (!workerId) {
            log('âš ï¸ Worker IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        const url = `ws://${window.location.host}/ws-gpu?workerId=${workerId}`;
        socket = new WebSocket(url);
        log(`ğŸ”Œ ì—°ê²° ì‹œë„: ${url}`);

        socket.onopen = function(event) {
            log('âœ… WebSocket ì—°ê²° ì„±ê³µ (GPU ì›Œì»¤)');
        };

        socket.onmessage = function(event) {
            if (event.data instanceof Blob) {
                event.data.arrayBuffer().then(buffer => {
                    const view = new Uint8Array(buffer);
                    log('ğŸ“¨ (ê³ ê°->GPU) ë°”ì´ë„ˆë¦¬ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + view.length + ' bytes');
                    log('   ë°ì´í„° ìƒ˜í”Œ: [' + Array.from(view.slice(0, 10)).join(', ') + '...]');
                });
            }
        };

        socket.onerror = function(error) {
            log('âŒ ì—ëŸ¬ ë°œìƒ: ' + error);
        };

        socket.onclose = function(event) {
            log('ğŸ”Œ ì—°ê²° ì¢…ë£Œ: ' + event.code + ' - ' + event.reason);
        };
    }

    function disconnect() {
        if (socket) {
            socket.close();
            socket = null;
        }
    }

    function sendTestData() {
        if (!socket || socket.readyState !== WebSocket.OPEN) {
            log('âš ï¸ ë¨¼ì € ì—°ê²°í•˜ì„¸ìš”');
            return;
        }

        // AI ì‘ë‹µ ë°ì´í„° (Gë¡œ ì‹œì‘)
        const data = new Uint8Array(1024);
        data[0] = 71; // 'G'
        for (let i = 1; i < data.length; i++) {
            data[i] = Math.floor(Math.random() * 256);
        }

        socket.send(data.buffer);
        log('ğŸ“¤ (GPU->ê³ ê°) AI ì‘ë‹µ ì „ì†¡: ' + data.length + ' bytes');
    }
</script>
</body>
</html>