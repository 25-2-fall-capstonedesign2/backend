<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test - CUSTOMER</title>
    <meta charset="UTF-8">
</head>
<body>
<h2>ê³ ê°(Client) WebSocket í…ŒìŠ¤íŠ¸ (/ws-client)</h2>
<div>
    <label for="sessionId">Call Session ID:</label>
    <input type="text" id="sessionId" value="101"> <button onclick="connect()">ì—°ê²°</button>
    <button onclick="disconnect()">ì—°ê²° ì¢…ë£Œ</button>
</div>
<div>
    <button onclick="sendTestData()">ìŒì„± ë°ì´í„°(ê³ ê°->GPU) ì „ì†¡</button>
</div>
<div>
    <h3>ë¡œê·¸:</h3>
    <pre id="log"></pre>
</div>

<script>
    let socket = null;

    function log(message) {
        const logEl = document.getElementById('log');
        logEl.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
    }

    function connect() {
        const sessionId = document.getElementById('sessionId').value;
        if (!sessionId) {
            log('âš ï¸ Call Session IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        const url = `ws://localhost:8080/ws-client?sessionId=${sessionId}`;
        socket = new WebSocket(url);
        log(`ğŸ”Œ ì—°ê²° ì‹œë„: ${url}`);

        socket.onopen = function(event) {
            log('âœ… WebSocket ì—°ê²° ì„±ê³µ (ê³ ê°)');
        };

        socket.onmessage = function(event) {
            if (event.data instanceof Blob) {
                event.data.arrayBuffer().then(buffer => {
                    const view = new Uint8Array(buffer);
                    log('ğŸ“¨ (GPU->ê³ ê°) ë°”ì´ë„ˆë¦¬ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + view.length + ' bytes');
                    log('   ë°ì´í„° ìƒ˜í”Œ: [' + Array.from(view.slice(0, 10)).join(', ') + '...]');
                });
            }
        };

        socket.onerror = function(error) {
            log('âŒ ì—ëŸ¬ ë°œìƒ: ' + error);
        };

        socket.onclose = function(event) {
            log('ğŸ”Œ ì—°ê²° ì¢…ë£Œ: ' + event.code + ' - ' + event.reason);
        };
    }

    function disconnect() {
        if (socket) {
            socket.close();
            socket = null;
        }
    }

    function sendTestData() {
        if (!socket || socket.readyState !== WebSocket.OPEN) {
            log('âš ï¸ ë¨¼ì € ì—°ê²°í•˜ì„¸ìš”');
            return;
        }

        // ê³ ê° ìŒì„± ë°ì´í„° (Cë¡œ ì‹œì‘)
        const data = new Uint8Array(1024);
        data[0] = 67; // 'C'
        for (let i = 1; i < data.length; i++) {
            data[i] = Math.floor(Math.random() * 256);
        }

        socket.send(data.buffer);
        log('ğŸ“¤ (ê³ ê°->GPU) ìŒì„± ë°ì´í„° ì „ì†¡: ' + data.length + ' bytes');
    }
</script>
</body>
</html>