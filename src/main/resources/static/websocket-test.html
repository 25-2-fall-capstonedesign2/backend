<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <meta charset="UTF-8">
</head>
<body>
<h2>WebSocket ë°”ì´ë„ˆë¦¬ í†µì‹  í…ŒìŠ¤íŠ¸</h2>
<div>
    <button onclick="connect()">ì—°ê²°</button>
    <button onclick="disconnect()">ì—°ê²° ì¢…ë£Œ</button>
    <button onclick="sendTestData()">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì „ì†¡</button>
</div>
<div>
    <h3>ë¡œê·¸:</h3>
    <pre id="log"></pre>
</div>

<script>
    let socket = null;

    function log(message) {
        const logEl = document.getElementById('log');
        logEl.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
    }

    function connect() {
        // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” JWT í† í° ì¶”ê°€ í•„ìš”
        socket = new WebSocket('ws://localhost:8080/ws/voice');

        socket.onopen = function(event) {
            log('âœ… WebSocket ì—°ê²° ì„±ê³µ');
        };

        socket.onmessage = function(event) {
            if (event.data instanceof Blob) {
                event.data.arrayBuffer().then(buffer => {
                    const view = new Uint8Array(buffer);
                    log('ğŸ“¨ ë°”ì´ë„ˆë¦¬ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + view.length + ' bytes');
                    log('   ë°ì´í„° ìƒ˜í”Œ: [' + Array.from(view.slice(0, 10)).join(', ') + '...]');
                });
            }
        };

        socket.onerror = function(error) {
            log('âŒ ì—ëŸ¬ ë°œìƒ: ' + error);
        };

        socket.onclose = function(event) {
            log('ğŸ”Œ ì—°ê²° ì¢…ë£Œ: ' + event.code + ' - ' + event.reason);
        };
    }

    function disconnect() {
        if (socket) {
            socket.close();
            socket = null;
        }
    }

    function sendTestData() {
        if (!socket || socket.readyState !== WebSocket.OPEN) {
            log('âš ï¸ ë¨¼ì € ì—°ê²°í•˜ì„¸ìš”');
            return;
        }

        // í…ŒìŠ¤íŠ¸ìš© ë°”ì´ë„ˆë¦¬ ë°ì´í„° ìƒì„± (1KB)
        const data = new Uint8Array(1024);
        for (let i = 0; i < data.length; i++) {
            data[i] = Math.floor(Math.random() * 256);
        }

        socket.send(data.buffer);
        log('ğŸ“¤ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì „ì†¡: ' + data.length + ' bytes');
    }
</script>
</body>
</html>